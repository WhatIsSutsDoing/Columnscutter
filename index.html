<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CSV Column Stacker</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0e0e0f;
    --surface: #18181b;
    --border: #2a2a2e;
    --accent: #e8ff5a;
    --accent2: #5affd6;
    --text: #f0f0f0;
    --muted: #666;
    --danger: #ff5a5a;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 48px 24px;
  }

  /* Grain overlay */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 999;
    opacity: 0.35;
  }

  header {
    text-align: center;
    margin-bottom: 48px;
    animation: fadeDown 0.6s ease both;
  }

  .tag {
    display: inline-block;
    font-size: 10px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--accent);
    border: 1px solid var(--accent);
    padding: 3px 10px;
    margin-bottom: 16px;
  }

  h1 {
    font-family: 'Syne', sans-serif;
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 800;
    line-height: 1;
    letter-spacing: -0.02em;
  }

  h1 span { color: var(--accent); }

  .subtitle {
    color: var(--muted);
    font-size: 13px;
    margin-top: 10px;
    letter-spacing: 0.05em;
  }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 32px;
    width: 100%;
    max-width: 860px;
    animation: fadeUp 0.6s ease both;
    animation-delay: 0.1s;
  }

  .card + .card { margin-top: 20px; animation-delay: 0.2s; }

  .card-title {
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--accent2);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .card-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* Drop Zone */
  .drop-zone {
    border: 2px dashed var(--border);
    border-radius: 4px;
    padding: 48px 24px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
  }

  .drop-zone:hover, .drop-zone.drag-over {
    border-color: var(--accent);
    background: rgba(232, 255, 90, 0.04);
  }

  .drop-zone input[type="file"] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
    width: 100%;
    height: 100%;
  }

  .drop-icon {
    font-size: 40px;
    margin-bottom: 12px;
    display: block;
  }

  .drop-text {
    font-family: 'Syne', sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 6px;
  }

  .drop-hint {
    font-size: 12px;
    color: var(--muted);
  }

  .file-name {
    display: none;
    margin-top: 16px;
    font-size: 12px;
    color: var(--accent);
    background: rgba(232, 255, 90, 0.08);
    padding: 6px 14px;
    border-radius: 2px;
    display: none;
    align-items: center;
    gap: 8px;
  }

  /* Logic diagram */
  .logic-diagram {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 0.05em;
    flex-wrap: wrap;
  }

  .logic-block {
    background: var(--bg);
    border: 1px solid var(--border);
    padding: 8px 14px;
    border-radius: 2px;
    text-align: center;
    line-height: 1.6;
  }

  .logic-block strong {
    display: block;
    color: var(--text);
    font-family: 'Syne', sans-serif;
    font-size: 13px;
  }

  .arrow {
    color: var(--accent);
    font-size: 18px;
    flex-shrink: 0;
  }

  .logic-block.highlight { border-color: var(--accent2); }
  .logic-block.highlight strong { color: var(--accent2); }

  /* Button */
  .btn {
    font-family: 'DM Mono', monospace;
    font-size: 13px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    border: none;
    padding: 14px 32px;
    cursor: pointer;
    transition: all 0.15s ease;
    border-radius: 2px;
  }

  .btn-primary {
    background: var(--accent);
    color: #0e0e0f;
    font-weight: 500;
  }

  .btn-primary:hover:not(:disabled) {
    background: #fff;
    transform: translateY(-1px);
    box-shadow: 0 4px 20px rgba(232,255,90,0.3);
  }

  .btn-primary:disabled { opacity: 0.3; cursor: not-allowed; }

  .btn-secondary {
    background: transparent;
    color: var(--accent2);
    border: 1px solid var(--accent2);
  }

  .btn-secondary:hover {
    background: rgba(90, 255, 214, 0.08);
    transform: translateY(-1px);
  }

  .btn-row {
    display: flex;
    gap: 12px;
    margin-top: 24px;
    flex-wrap: wrap;
  }

  /* Error */
  .error-msg {
    display: none;
    background: rgba(255, 90, 90, 0.1);
    border: 1px solid var(--danger);
    color: var(--danger);
    font-size: 12px;
    padding: 10px 16px;
    border-radius: 2px;
    margin-top: 16px;
  }

  /* Preview table */
  .preview-wrap {
    overflow-x: auto;
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid var(--border);
    border-radius: 2px;
  }

  .preview-wrap::-webkit-scrollbar { width: 6px; height: 6px; }
  .preview-wrap::-webkit-scrollbar-track { background: var(--bg); }
  .preview-wrap::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  table {
    border-collapse: collapse;
    font-size: 11px;
    width: max-content;
    min-width: 100%;
  }

  th {
    background: var(--bg);
    color: var(--accent);
    font-family: 'Syne', sans-serif;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 10px 14px;
    border-bottom: 1px solid var(--border);
    border-right: 1px solid var(--border);
    white-space: nowrap;
    position: sticky;
    top: 0;
    z-index: 1;
  }

  td {
    padding: 8px 14px;
    border-bottom: 1px solid rgba(42,42,46,0.6);
    border-right: 1px solid rgba(42,42,46,0.4);
    white-space: nowrap;
    color: #c0c0c0;
  }

  tr.stacked-row td { color: var(--accent2); }

  tr.separator td {
    border-top: 2px solid var(--accent2);
    font-size: 9px;
    color: var(--accent2);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    background: rgba(90, 255, 214, 0.04);
    padding: 4px 14px;
  }

  .stats {
    display: flex;
    gap: 24px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .stat {
    font-size: 11px;
    color: var(--muted);
  }

  .stat strong {
    display: block;
    font-family: 'Syne', sans-serif;
    font-size: 22px;
    font-weight: 800;
    color: var(--text);
    line-height: 1;
    margin-bottom: 2px;
  }

  /* Animations */
  @keyframes fadeDown {
    from { opacity: 0; transform: translateY(-20px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  #result-section { display: none; animation: fadeUp 0.4s ease both; }
</style>
</head>
<body>

<header>
  <div class="tag">CSV Tool</div>
  <h1>Column <span>Stacker</span></h1>
  <p class="subtitle">Split 26 columns â†’ stack cols 14â€“26 beneath cols 1â€“13</p>
</header>

<!-- Upload Card -->
<div class="card">
  <div class="card-title">01 â€” Upload CSV</div>

  <div class="drop-zone" id="dropZone">
    <input type="file" id="fileInput" accept=".csv">
    <span class="drop-icon">ðŸ“‚</span>
    <div class="drop-text">Drop your CSV here or click to browse</div>
    <div class="drop-hint">Must have at least 26 columns</div>
  </div>

  <div class="error-msg" id="errorMsg"></div>

  <div class="btn-row">
    <button class="btn btn-primary" id="convertBtn" disabled>Convert â†’</button>
  </div>
</div>

<!-- Logic Card -->
<div class="card">
  <div class="card-title">02 â€” Transformation Logic</div>
  <div class="logic-diagram">
    <div class="logic-block">
      <strong>Input</strong>
      26 columns<br>with headers
    </div>
    <div class="arrow">â†’</div>
    <div class="logic-block highlight">
      <strong>Cols 1â€“13</strong>
      keep headers<br>keep rows
    </div>
    <div class="arrow">+</div>
    <div class="logic-block">
      <strong>Cols 14â€“26</strong>
      strip headers<br>stack below
    </div>
    <div class="arrow">=</div>
    <div class="logic-block highlight">
      <strong>Output</strong>
      13 columns<br>2Ã— the rows
    </div>
  </div>
</div>

<!-- Result Card -->
<div class="card" id="result-section">
  <div class="card-title">03 â€” Preview & Download</div>

  <div class="stats">
    <div class="stat"><strong id="stat-original">â€”</strong>original rows</div>
    <div class="stat"><strong id="stat-output">â€”</strong>output rows</div>
    <div class="stat"><strong id="stat-cols">13</strong>columns</div>
  </div>

  <div class="preview-wrap">
    <table id="previewTable"></table>
  </div>

  <div class="btn-row">
    <button class="btn btn-primary" id="downloadBtn">â¬‡ Download CSV</button>
    <button class="btn btn-secondary" id="resetBtn">Reset</button>
  </div>
</div>

<script>
  const fileInput   = document.getElementById('fileInput');
  const dropZone    = document.getElementById('dropZone');
  const convertBtn  = document.getElementById('convertBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const resetBtn    = document.getElementById('resetBtn');
  const errorMsg    = document.getElementById('errorMsg');
  const resultSection = document.getElementById('result-section');
  const previewTable  = document.getElementById('previewTable');

  let outputRows = [];
  let outputHeaders = [];
  let fileName = 'converted.csv';

  // Drag events
  dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('drag-over'); });
  dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
  dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('drag-over');
    const file = e.dataTransfer.files[0];
    if (file) handleFile(file);
  });

  fileInput.addEventListener('change', () => {
    if (fileInput.files[0]) handleFile(fileInput.files[0]);
  });

  function handleFile(file) {
    if (!file.name.endsWith('.csv')) return showError('Please upload a .csv file.');
    fileName = file.name.replace('.csv', '_converted.csv');
    const hint = dropZone.querySelector('.drop-hint');
    hint.textContent = `âœ“ ${file.name}`;
    hint.style.color = 'var(--accent)';
    convertBtn.disabled = false;
    hideError();

    convertBtn.onclick = () => {
      const reader = new FileReader();
      reader.onload = e => processCSV(e.target.result);
      reader.readAsText(file);
    };
  }

  function parseCSVLine(line) {
    const result = [];
    let cur = '', inQuotes = false;
    for (let i = 0; i < line.length; i++) {
      const ch = line[i];
      if (ch === '"') {
        if (inQuotes && line[i+1] === '"') { cur += '"'; i++; }
        else inQuotes = !inQuotes;
      } else if (ch === ',' && !inQuotes) {
        result.push(cur); cur = '';
      } else {
        cur += ch;
      }
    }
    result.push(cur);
    return result;
  }

  function processCSV(text) {
    hideError();
    const lines = text.trim().split(/\r?\n/).filter(l => l.trim() !== '');
    if (lines.length < 2) return showError('CSV must have a header row and at least one data row.');

    const allRows = lines.map(parseCSVLine);
    const headers = allRows[0];
    const dataRows = allRows.slice(1);

    if (headers.length < 26) return showError(`CSV has only ${headers.length} columns. Need at least 26.`);

    // Split headers and data
    outputHeaders = headers.slice(0, 13);

    const topRows    = dataRows.map(r => r.slice(0, 13));
    const bottomRows = dataRows.map(r => r.slice(13, 26));

    outputRows = [...topRows, ...bottomRows];

    // Update stats
    document.getElementById('stat-original').textContent = dataRows.length;
    document.getElementById('stat-output').textContent   = outputRows.length;

    renderTable();
    resultSection.style.display = 'block';
    resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  function renderTable() {
    let html = '<thead><tr>';
    outputHeaders.forEach(h => { html += `<th>${escHtml(h)}</th>`; });
    html += '</tr></thead><tbody>';

    // Determine where stacked rows begin
    const splitAt = outputRows.length / 2;

    outputRows.forEach((row, i) => {
      if (i === splitAt) {
        html += `<tr class="separator">${'<td>â†“ stacked data (cols 14â€“26)</td>'.repeat(1)}<td colspan="${outputHeaders.length - 1}"></td></tr>`;
      }
      const cls = i >= splitAt ? ' class="stacked-row"' : '';
      html += `<tr${cls}>`;
      for (let c = 0; c < 13; c++) {
        html += `<td>${escHtml(row[c] ?? '')}</td>`;
      }
      html += '</tr>';
    });

    html += '</tbody>';
    previewTable.innerHTML = html;
  }

  function escHtml(str) {
    return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  downloadBtn.addEventListener('click', () => {
    const csvLines = [outputHeaders.map(csvCell).join(',')];
    outputRows.forEach(row => {
      csvLines.push(Array.from({length: 13}, (_, i) => csvCell(row[i] ?? '')).join(','));
    });
    const blob = new Blob([csvLines.join('\r\n')], { type: 'text/csv' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = fileName;
    a.click();
    URL.revokeObjectURL(a.href);
  });

  resetBtn.addEventListener('click', () => {
    fileInput.value = '';
    convertBtn.disabled = true;
    resultSection.style.display = 'none';
    outputRows = []; outputHeaders = [];
    const hint = dropZone.querySelector('.drop-hint');
    hint.textContent = 'Must have at least 26 columns';
    hint.style.color = '';
    hideError();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  function csvCell(val) {
    const s = String(val);
    return (s.includes(',') || s.includes('"') || s.includes('\n'))
      ? `"${s.replace(/"/g, '""')}"` : s;
  }

  function showError(msg) { errorMsg.textContent = msg; errorMsg.style.display = 'block'; }
  function hideError() { errorMsg.style.display = 'none'; }
</script>
</body>
</html>
